{"version":3,"sources":["jquery.scrollmenu.js"],"names":["$","document","history","location","elem","data","menu","opts","deepIndex","uniqueId","isJumping","init","settings","extend","fn","scrollmenu","defaults","items","find","start","not","disableHeaderSelector","build","addClass","menuClass","window","scroll","onScroll","ready","hash","jumpTo","substr","setClasses","click","e","preventDefault","this","jumpSpeed","options","each","i","item","buildAnchor","li","append","buildReference","depth","deepSelector","replace","str","parseInt","deepItems","nextUntil","tagName","length","a","text","attr","id","p1","p2","toLowerCase","generatedId","oldId","generateUniqueId","prefix","suffix","getElementById","getCurrent","current","filter","offsetActive","scrollTop","offset","top","nextAll","toggleWhileJumping","activeLi","parent","activeClass","parentLi","parents","parentClass","add","siblings","removeClass","speed","onJumpBefore","apply","offsetScroll","animate","onJumpAfter","pushState","pushToHistory","title","pathname","methods","refresh","destroy","removeAttr","remove","get","arguments","Array","prototype","slice","call","jQuery"],"mappings":"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","file":"jquery.scrollmenu.js","sourcesContent":["\r\n'use strict';\r\n\r\n(function($, document, history, location) {\r\n\r\n  /**\r\n   * Element\r\n   * @type {jQuery Object}\r\n   */\r\n  var elem;\r\n\r\n  /**\r\n   * Stored data\r\n   * @type {Object}\r\n   */\r\n  var data;\r\n\r\n  /**\r\n   * Options\r\n   * @type {Object}\r\n   */\r\n  var opts = {};\r\n\r\n  /**\r\n   * Current deep index.\r\n   * @type {Integer}\r\n   */\r\n  var deepIndex = 0;\r\n\r\n  /**\r\n   * Counter for generating unique IDs - increased by one if ID exists.\r\n   * @type {Integer}\r\n   */\r\n  var uniqueId = 0;\r\n\r\n  /**\r\n   * Whole menu.\r\n   * @type {jQuery Object}\r\n   */\r\n  var menu;\r\n\r\n  /**\r\n   * Set to 'true' while jumping to a header.\r\n   * @type {boolean}\r\n   */\r\n  var isJumping = false;\r\n\r\n  ////////////////////////\r\n  // Private functions  //\r\n  ////////////////////////\r\n\r\n  /**\r\n   * Initialization\r\n   * @param {object} settings - Options that should overwrite the defaults.\r\n   */\r\n  var init = function(settings) {\r\n    opts = $.extend(true, {}, $.fn.scrollmenu.defaults, settings);\r\n\r\n    // Find all first level items\r\n    // TODO: Remove `.not(opts.disableHeaderSelector)` in next major release.\r\n    var items = $(elem.find(opts.start).not(opts.not).not(opts.disableHeaderSelector));\r\n    menu = build(items).addClass(opts.menuClass);\r\n\r\n    // Bind onScroll event\r\n    $(window).scroll(function() {\r\n      onScroll();\r\n    });\r\n\r\n    $(document).ready(function() {\r\n      if (location.hash) {\r\n        jumpTo(location.hash.substr(1), 0);\r\n      }\r\n      setClasses();\r\n    });\r\n\r\n    // Bind jumpTo event to menu anchors\r\n    menu.find('a').click(function(e) {\r\n      e.preventDefault();\r\n      jumpTo(this.hash.substr(1), opts.jumpSpeed);\r\n    });\r\n\r\n    // Bind options to container element\r\n    elem.data('scrollmenu', {\r\n      options: opts,\r\n      menu: menu,\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Build list recursively\r\n   * @param {jQuery object} items - All headers in this level.\r\n   * @return {jQuery object} Unordered list\r\n   */\r\n  var build = function(items) {\r\n    var menu = $('<ul />');\r\n\r\n    // Current items\r\n    items.each(function(i, item) {\r\n      item = buildAnchor($(item));\r\n      var li = $('<li />');\r\n      li.append(buildReference($(item)));\r\n\r\n      if (deepIndex < opts.depth) {\r\n        // Deep selector\r\n        var deepSelector = opts.start.replace(/\\d+/, function(str) {\r\n          return parseInt(str) + deepIndex + 1;\r\n        });\r\n\r\n        // Deep items\r\n        // TODO: Remove `.not(opts.disableHeaderSelector)` in next major release.\r\n        var deepItems = item.nextUntil(item[0].tagName, deepSelector).not(opts.not).not(opts.disableHeaderSelector);\r\n        if (deepItems.length > 0) {\r\n          deepIndex++;\r\n          li.append(build(deepItems));\r\n          deepIndex--;\r\n        }\r\n      }\r\n\r\n      menu.append(li);\r\n    });\r\n\r\n    return menu;\r\n  };\r\n\r\n  /**\r\n   * Build an `<a>` element from an item.\r\n   * @param {jQuery object} item\r\n   * @return {jQuery object}\r\n   */\r\n  var buildReference = function(item) {\r\n    var a = $('<a />');\r\n    uniqueId = 0;\r\n\r\n    a.text(item.text());\r\n    a.attr('href', '#' + item.attr('id'));\r\n\r\n    return a;\r\n  };\r\n\r\n  /**\r\n   * Build an anchor (ID) for the current item.\r\n   * @param {jQuery object} item\r\n   * @return {jQuery object}\r\n   */\r\n  var buildAnchor = function(item) {\r\n    var id = item.attr('id');\r\n\r\n    // Generate a new ID, if not exists\r\n    if (typeof id === 'undefined') {\r\n      id = item.text().replace(/(\\s+)|(#+)/g, function(str, p1, p2) {\r\n        if (p1) return '-'; // Replace spaces\r\n        if (p2) return ''; // Replace '#'\r\n      }).toLowerCase();\r\n      item.data('scrollmenu', { generatedId: id });\r\n    }\r\n\r\n    // Make it unique, if necessary\r\n    // The `[id=\"' + id + '\"]` selector is the only way to check for\r\n    // duplicated IDs\r\n    if (!id || $('[id=\"' + id + '\"]').length > 1) {\r\n      var data = { oldId: id };\r\n\r\n      id = generateUniqueId(id + '-');\r\n\r\n      data.generatedId = id;\r\n      item.data('scrollmenu', data);\r\n    }\r\n\r\n    item.attr('id', id);\r\n    return item;\r\n  };\r\n\r\n  /**\r\n   * Generate a new unique id\r\n   * @param {String} prefix\r\n   * @param {String} suffix\r\n   * @return {String}\r\n   */\r\n  var generateUniqueId = function(prefix, suffix) {\r\n    prefix = (typeof prefix !== 'undefined') ? prefix : '';\r\n    suffix = (typeof suffix !== 'undefined') ? suffix : '';\r\n    uniqueId++;\r\n\r\n    var id = prefix + uniqueId + suffix;\r\n    if ($(document.getElementById(id)).length) {\r\n      return generateUniqueId(prefix, suffix);\r\n    }\r\n    return id;\r\n  };\r\n\r\n  /**\r\n   * Get current ID\r\n   * @return {String}\r\n   */\r\n  var getCurrent = function() {\r\n    var current = false;\r\n\r\n    // Loop through all IDs, filtered by headers\r\n    $('[id]').filter(':header').each(function() {\r\n      var offsetActive = $(window).scrollTop() + opts.offsetActive;\r\n      if ($(this).offset().top <= offsetActive) {\r\n        if ($(this).nextAll('[id]').length === 0 || $(this).nextAll('[id]').offset().top > offsetActive) {\r\n          current = $(this).attr('id');\r\n          return false;\r\n        }\r\n      }\r\n    });\r\n\r\n    return current;\r\n  };\r\n\r\n  /**\r\n   * Bind scroll event\r\n   */\r\n  var onScroll = function() {\r\n    // Toggle classes while scrolling (special on jumping)\r\n    if (!(!opts.toggleWhileJumping && isJumping)) {\r\n      setClasses();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Set and reset all classes as required\r\n   */\r\n  var setClasses = function() {\r\n    var current = getCurrent();\r\n\r\n    // Find active `<li>`.\r\n    var activeLi = menu.find('li a').filter(function() {\r\n      return $(this).attr('href') == '#' + current;\r\n    }).parent();\r\n\r\n    // Add `.active` class to current.\r\n    activeLi.addClass(opts.activeClass);\r\n\r\n    // Add `.active` class to parent (or to current, if there is no parent).\r\n    var parentLi = activeLi.parents('li');\r\n    parentLi = parentLi.length ? parentLi : activeLi;\r\n    parentLi.addClass(opts.parentClass);\r\n\r\n    // Remove all other `.active` classes.\r\n    activeLi.add(parentLi).siblings().removeClass(opts.activeClass).removeClass(opts.parentClass);\r\n  };\r\n\r\n  /**\r\n   * Jump to a heading\r\n   * @param {string} id - The ID to jump to\r\n   * @param {integer} Scroll speed\r\n   */\r\n  var jumpTo = function(id, speed) {\r\n    var current = getCurrent();\r\n    isJumping = true;\r\n    opts.onJumpBefore.apply(this, [id, current]);\r\n    var scrollTop = $(document.getElementById(id)).offset().top - opts.offsetScroll;\r\n\r\n    $('html, body').animate({\r\n      scrollTop: scrollTop,\r\n    }, speed, function() {\r\n      if (!opts.toggleWhileJumping) {\r\n        setClasses();\r\n      }\r\n      isJumping = false;\r\n      opts.onJumpAfter.apply(this, [id, current]);\r\n    });\r\n\r\n    // Add to history\r\n    if (!!(history && history.pushState) && opts.pushToHistory) {\r\n      history.pushState({}, document.title, location.pathname + '#' + id);\r\n    }\r\n  };\r\n\r\n  ////////////////////\r\n  // Public Methods //\r\n  ////////////////////\r\n\r\n  var methods = {\r\n\r\n    /**\r\n     * Refresh\r\n     * @param {object} settings - New settings\r\n     */\r\n    refresh: function(settings) {\r\n      // Reset all\r\n      methods.destroy();\r\n\r\n      // Start new\r\n      if (typeof settings === 'undefined') {\r\n        settings = opts;\r\n      }\r\n      init(settings);\r\n    },\r\n\r\n    /**\r\n     * Destroyer\r\n     * Remove all data, classes and inserted elements.\r\n     */\r\n    destroy: function() {\r\n      // Get all headers, filter by data.scrollmenu\r\n      $(':header').filter(function() {\r\n        return !!$(this).data('scrollmenu');\r\n      }).each(function() {\r\n        var data = $(this).data('scrollmenu');\r\n\r\n        // Reset old ID, if set (and no new one is set)\r\n        if (('generatedId' in data) && data.generatedId == $(this).attr('id')) {\r\n          if ('oldId' in data) {\r\n            $(this).attr('id', data.oldId);\r\n          }else{\r\n            $(this).removeAttr('id');\r\n          }\r\n        }\r\n      });\r\n\r\n      // Remove inserted menu\r\n      menu.remove();\r\n    },\r\n\r\n    /**\r\n     * Get the built menu\r\n     * @return {jQuery Object} Unordered list\r\n     */\r\n    get: function() {\r\n      return menu;\r\n    }\r\n  };\r\n\r\n  /////////////\r\n  // Plugin  //\r\n  /////////////\r\n\r\n  $.fn.scrollmenu = function() {\r\n    elem = $(this);\r\n\r\n    if (typeof elem.data('scrollmenu') === 'undefined') {\r\n      // Init\r\n      init.apply(this, arguments);\r\n      elem.data('scrollmenu', data);\r\n    }else{\r\n      // Find methods\r\n      if (arguments[0] in methods) {\r\n        data = elem.data('scrollmenu');\r\n        opts = data.options;\r\n        menu = data.menu;\r\n\r\n        return methods[arguments[0]].apply(this, Array.prototype.slice.call(arguments, 1));\r\n      }\r\n    }\r\n\r\n    return elem;\r\n  };\r\n\r\n  /////////////////////\r\n  // Default Options //\r\n  /////////////////////\r\n\r\n  $.fn.scrollmenu.defaults = {\r\n    start:                  'h2',           // Start at this header.\r\n    depth:                  2,              // Depth from `start` point; 0 for disabling depth selectors.\r\n    jumpSpeed:              400,            // Scroll speed when click on a menu item; 0 for disabling.\r\n    offsetScroll:           0,              // Amount of pixels from the window top.\r\n    offsetActive:           0,              // Active item offset. Will set the active class on the menu earlier the higher it is.\r\n    toggleWhileJumping:     false,          // Toggle classes while jumping (scrolling) to a header.\r\n    disableHeaderSelector:  '[disabled]',   // Selector to disable a header. Will be used within the `.not()` function.\r\n    not:                    '[disabled]',   // Selector or function to disable a header. Will be used within the `.not()` function.\r\n    activeClass:            'active',       // Class name for current list item.\r\n    parentClass:            'active',       // Class name for parent list item of the current item.\r\n    menuClass:              'menu',         // Class name for the root list.\r\n    pushToHistory:          true,           // Add to browser history (IE>9 required).\r\n\r\n    onJumpBefore:           function() {},  // Fired before jumping to a header.\r\n    onJumpAfter:            function() {},  // Fired after jumping to a header.\r\n  };\r\n}(jQuery, window.document, window.history, window.location));\r\n"],"sourceRoot":"/source/"}